# p2p

设计与实现p2p的核心功能与接口，并且提供main.cpp示例

## 技术栈要求
使用cpp，环境是linux，二进制文件操作。
要用到上一个目录，即service目录下的多个已经实现的模块，包括但不限于nat-traversal, store, tcp-like 这些模块的接口
也允许你对这些模块里的代码进行适当的调整以适应配合当前的p2p模块

## 功能模块需求
* 要抽象出peer这个对象，维护它所需要的信息，例如pid，nat类型，亦或是对某个peer发起通信的接口等

* peer网络建立
两个peer之间使用nat-traversal、tcp-like两模块组合完成nat穿透和基于udp的可靠连接，并以此来相互传输数据和命令（注意，“数据”和“命令”是两种东西，当然你也可以想办法把他们大统一成一种结构来传输，即你可以自定义应用层协议来完成需求）
要维护“peer路由表”，即“当前正与自身连接的有哪些peer”，以及“曾连过 但处于离线的peer”
路由表中存在一个始终认为在线的超级peer，它其实本质上是一个中心化的服务器，但是它只是作为备用的 辅助的，在进行节点发现之类的活动时，superpeer的优先级总是最低的。superpeer继承于peer，重写了“是否在线”或者其他相关的方法。
可以直接对一个peer调用“connect成员函数”尝试直连一个peer，有可能会失败或者成功。成功后会把peer放进已经连接的路由表
可以接收到来自其他peer的连接请求，成功后加入路由表。
连接成功后两个peer通过tcp-like目录下的可靠udp连接来通信。
可以对在线的peer发起“协助我进行内网穿透连接pid（peer id）”的请求，如果协助成功，会传回相关的可用信息，例如对方nat类型，对方穿透成功之后的ip和端口之类的信息
可以收到“协助我连接pid的请求” 此时会检索自己的表里是否存在pid这个peer，有的话就尝试连接，已经处于连接就向该peer发送“请向某某(包含ip 端口 pid等信息)发起连接”的命令
可以收到“请向某某发起连接”的命令，并建立一个新的peer对象尝试连接，成功后放进路由表

* peer间的资源查找（DHT）
使用Kademlia协议

* peer间的数据传输
请求接口 vector<uint_8> getData(string sid, int begin) 
发送接口 int getData(string sid, vector<uint_8> data) 返回成功的字节数

* 资源数据管理存储
标识资源的方式就是一个字符串sid
提供保存新资源的接口 bool createData(string sid, vector<uint_8> data)
该接口一般是在接收到来自peer的资源后，保存本地用的，又或者是上层应用调用，把外部文件保存为资源
获取资源的接口vector<uint_8> findData(string sid) 这个接口里面包含了从本地查找资源、从p2p网络查找资源等逻辑，最终返回结果。

## 项目录结构要求

目录结构清晰，模块划分清晰，接口设计与实现清晰，内外部接口权限划分清晰；
可以适当对其他模块做调整，以适应各个模块间的协作